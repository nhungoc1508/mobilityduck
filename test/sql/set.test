# name: test/sql/mobilityduck.test
# description: test mobilityduck extension
# group: [sql]

# Require statement will ensure this test is run with this extension loaded
require mobilityduck


# input 
query I
SELECT intset '{-1,-3,3}';
----
{-3, -1, 3}

query I
SELECT floatset '{-1.2,-3.1,3}';
----
{-3.1, -1.2, 3}

query I
SELECT tstzset '{2001-01-01 08:00:00, 2001-01-03 09:30:00}'; 
----
{"2001-01-01 08:00:00+00", "2001-01-03 09:30:00+00"}

query I
SELECT dateset '{2001-02-01}';
----
{2001-02-01}

query I 
SELECT textset '{"highway", "car"}';
----
{"car", "highway"}

# asText 

query I
SELECT asText(intset '{-1,-3,3}');
----
{-3, -1, 3}

query I 
SELECT asText(floatset '{1.123456789,2.123456789}', 3);
----
{1.123, 2.123}

# constructor
query I
SELECT set([1, 2, 3]);
----
{1, 2, 3}

query I
SELECT set([1.2,1.5]);
----
{1.2, 1.5}

query I 
SELECT set(ARRAY[timestamptz '2001-01-01 08:00:00', '2001-01-03 09:30:00']);
----
{"2001-01-01 08:00:00+00", "2001-01-03 09:30:00+00"}

query I 
SELECT set(ARRAY['highway', 'primary', 'secondary']);
----
{"highway", "primary", "secondary"}

# Conversion

query I 
SELECT 5::intset;
----
{5}

query I
SELECT DOUBLE '1.5'::floatset;
----
{1.5}

query I
SELECT CAST(TIMESTAMPTZ'2001-01-01 08:00:00' AS tstzset);
----
{"2001-01-01 08:00:00+00"}

query I 
SELECT CAST(DATE'2001-01-01' AS dateset); 
----
{2001-01-01}

query I 
SELECT 'car'::TEXTSET;
----
{"car"}

query I 
SELECT intset '{1,2,3}'::floatset;
----
{1, 2, 3}

query I 
SELECT floatset '{1.5, 2.3, 3.7}'::intset;
----
{1, 2, 3}

query I 
SELECT intset(floatset '{1.5, 2.3, 3.7}');
----
{1, 2, 3}

query I 
SELECT tstzset '{2001-01-01 08:00:00, 2001-01-03 09:30:00}' :: dateset; 
----
{2001-01-01, 2001-01-03}

query I 
SELECT dateset '{2001-01-01, 2001-01-03}' :: tstzset;
----
{"2001-01-01 00:00:00+00", "2001-01-03 00:00:00+00"}

query I 
SELECT memSize(tstzset '{2001-01-01, 2001-01-02, 2001-01-03}');
----
48

query I 
SELECT startValue(floatset '{-1.2,-3.1,3}');
----
-3.1

query I 
SELECT valueN(intset '{-2, 2, 7}' ,1);
----
-2

query I 
SELECT valueN(intset '{-2, 2, 7}', 4);
----
NULL

query I 
SELECT shift(intset '{1,2,3}', 4);
----
{5, 6, 7}


query I 
SELECT shift(dateset '{2000-01-01, 2000-01-02, 2000-01-03}', 30);
----
{2000-01-31, 2000-02-01, 2000-02-02}

query I 
SELECT shift(floatset'{1.5,2.5,3.5}', 4);
----
{5.5, 6.5, 7.5}

query I 
SELECT shift(tstzset '{2000-01-01, 2000-01-02, 2000-01-03}', '5 min');
----
{"2000-01-01 00:05:00+00", "2000-01-02 00:05:00+00", "2000-01-03 00:05:00+00"}

query I 
SELECT scale(intset '{1}', 4);
----
{1}

query I 
SELECT scale(dateset '{2000-01-01, 2000-01-02, 2000-01-03}', 4);
----
{2000-01-01, 2000-01-03, 2000-01-06}


query I 
SELECT scale(tstzset '{2000-01-01}', '1 hour');
----
{"2000-01-01 00:00:00+00"}

query I 
SELECT scale(tstzset '{2000-01-01, 2000-01-02, 2000-01-03}', '1 hour');
----
{"2000-01-01 00:00:00+00", "2000-01-01 00:30:00+00", "2000-01-01 01:00:00+00"}

query I 
SELECT shiftScale(intset '{1}', 4, 4);
----
{5}

query I 
SELECT shiftScale(dateset '{2000-01-01, 2000-01-02, 2000-01-03}', 4, 4);
----
{2000-01-05, 2000-01-07, 2000-01-10}

query I 
SELECT shiftScale(tstzset '{2000-01-01}', '1 day', '1 hour');
----
{"2000-01-02 00:00:00+00"}

query I 
SELECT shiftScale(tstzset '{2000-01-01, 2000-01-02, 2000-01-03}', '1 day', '1 hour');
----
{"2000-01-02 00:00:00+00", "2000-01-02 00:30:00+00", "2000-01-02 01:00:00+00"}

query I 
SELECT floor(floatset '{0.5, 1.5, 2.5}');
----
{0, 1, 2}

query I 
SELECT floor(floatset '{0.5, 1.5, 1.6}');
----
{0, 1}

query I 
SELECT ceil(floatset '{0.5, 1.5, 2.5}');
----
{1, 2, 3}

query I
SELECT ceil(floatset '{0.5, 1.5, 1.6}');
----
{1, 2}

query I
SELECT round(floatset '{0.12345, 1.12345, 2.12345}', 3);
----
{0.123, 1.123, 2.123}

query I 
SELECT degrees(floatset '{0, 0.5, 1}', true);
----
{0, 28.64788975654116, 57.29577951308232}

query I
SELECT radians(floatset '{0, 45, 90}');
----
{0, 0.785398163397448, 1.570796326794897}

query I 
SELECT lower(textset '{"AAA", "BBB", "CCC"}');
----
{"aaa", "bbb", "ccc"}

query I
SELECT upper(textset '{"aaa", "bbb", "ccc"}');
----
{"AAA", "BBB", "CCC"}

query I
SELECT initcap(textset '{"aaa", "bbb", "ccc"}');
----
{"Aaa", "Bbb", "Ccc"}

query I 
SELECT * FROM setUnnest(intset '{1, 1, 5, -7, -7}');
----
-7
1
5

query I 
SELECT * FROM setUnnest(dateset '{2001-02-01, 2022-02-18}');
----
2001-02-01
2022-02-18

query I 
SELECT * FROM setUnnest(textset '{"highway", "car", "bike"}');
----
bike
car
highway

query I 
SELECT * FROM setUnnest(tstzset '{2001-01-01 08:00:00, 2001-01-03 09:30:00}');
----
2001-01-01 08:00:00+00
2001-01-03 09:30:00+00